<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Microcontroller (µC)</title>
<meta name="generator" content="Org mode" />
<meta name="description" content="prototypage rapide"
 />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Microcontroller (µC)</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org8c0027b">Généralités</a></li>
<li><a href="#orge177457">Carte d'évaluation Nucleo</a>
<ul>
<li><a href="#org04d1b26">LED (Utilisateur)</a>
<ul>
<li><a href="#org49f3862">Hardware</a></li>
</ul>
</li>
<li><a href="#org580ce08">Bouton Poussoir (Utilisateur)</a>
<ul>
<li><a href="#orgd3fa37c">Hardware</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org75d76c9">Le microcontroller</a>
<ul>
<li><a href="#org47d9aaf">Caractéristiques</a></li>
<li><a href="#org5b31f0a">Architecture</a></li>
</ul>
</li>
<li><a href="#orgb901e97">CubeIDE: Configuration du projet</a></li>
<li><a href="#orgc251c19">CubeIDE: Configuration et utilisation des périphériques</a>
<ul>
<li><a href="#org593242f">NomDuProjet.ioc</a></li>
<li><a href="#orgf10191d">HAL (Hardware Abstraction Layer)</a></li>
<li><a href="#orgf8081eb">GPIO (General purpose Input Outpout.)</a>
<ul>
<li><a href="#org961560b">Configuration</a></li>
<li><a href="#orgfeecf0b">main.h</a></li>
<li><a href="#orgca774ac">main.c</a></li>
<li><a href="#org1eb8a8c">Ecriture</a></li>
<li><a href="#orge940a30">Lecture</a></li>
</ul>
</li>
<li><a href="#orgf014e6e">Délai</a></li>
<li><a href="#orgdfcccbf">RS232</a>
<ul>
<li><a href="#org2b0d1be">Configuration</a></li>
<li><a href="#org7c07dd5">Emission (µC vers PC)</a></li>
<li><a href="#org422f457">Reception (PC vers µC)</a></li>
</ul>
</li>
<li><a href="#org067870e">Convertisseur analogique-numérique</a>
<ul>
<li><a href="#orge3199ec">Configuration</a></li>
<li><a href="#orgdcaf961">Utilisation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2c2f3d5">Exemple de projet avec CubeIDE</a></li>
<li><a href="#org90b65db">Tutoriels CubeIde</a>
<ul>
<li><a href="#orgb0df850">Prise en main</a></li>
<li><a href="#orgf404a06">Exemple d'interface avec un capteur I2C</a></li>
<li><a href="#org7a94ae9">Compteur et interruption</a></li>
</ul>
</li>
<li><a href="#org407f99b">Exercices</a>
<ul>
<li><a href="#org4a1a133">Exercice 1</a></li>
<li><a href="#org2b3cbd1">Exercice 2</a></li>
<li><a href="#org51ad3f3">Exercice 3</a></li>
<li><a href="#org40107c5">Exercice 4</a></li>
<li><a href="#org788db2f">Exercice 5</a></li>
</ul>
</li>
<li><a href="#orgc923cc5">Annexes</a>
<ul>
<li><a href="#org1dad054">Nom de broches</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org8c0027b" class="outline-2">
<h2 id="org8c0027b">Généralités</h2>
<div class="outline-text-2" id="text-org8c0027b">
<p width="150px" style="float:left;margin:0px 20px 20px 0px;">
<img src="./img/uc.jpg" alt="uc.jpg" width="150px" style="float:left;margin:0px 20px 20px 0px;" />
Un microcontroller (µC) est une puce programmable en C ou C++ pour la majorité des cas. 
En première approche, on peut voir cette puce comme un micro ordinateur, car elle intègre non seulement une unité de calcul (micro processeur), mais egalement des périphériques. 
Comme de la mémoire FLASH (program memory), mémoire RAM (data memory), convertisseur (NA ou AN), controller de bus&#x2026;
Ces périphériques sont reliés via un bus interne, décris ci desssous comme un bus système.
</p>


<div class="figure">
<p><img src="./img/uc_arch.png" alt="uc_arch.png" width="500px" />
</p>
</div>



<p>
Du fait que tout soit intégré dans une puce, les microcontroller sont compacts, économes en énergie et donc tout désigné pour être embarqué. 
La plupart du temps le µC va s'interfacer avec des capteurs dont le rôle est de capter des grandeurs physiques.
En général, les variations de ces grandeurs physiques feront varier une resistance, une capacité ou inductance qui au final pourra être convertie en tension (ou en courant), et donc exploitable par le ÂµC.
</p>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Capteurs</th>
<th scope="col" class="org-left">Grandeur physique</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Bouton</td>
<td class="org-left">Pression</td>
</tr>

<tr>
<td class="org-left">Potentiometre</td>
<td class="org-left">Angle</td>
</tr>

<tr>
<td class="org-left">Thermoresistance</td>
<td class="org-left">Temperature</td>
</tr>

<tr>
<td class="org-left">Photodiode</td>
<td class="org-left">Lumière</td>
</tr>

<tr>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
</tr>
</tbody>
</table>

<p>
De là, il pourra réaliser un traitement et des actions, via des actionneurs auquels il est également interfacé.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Actionneurs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">LED</td>
</tr>

<tr>
<td class="org-left">Servomoteur</td>
</tr>

<tr>
<td class="org-left">Moteur</td>
</tr>

<tr>
<td class="org-left">Ecran</td>
</tr>

<tr>
<td class="org-left">&#x2026;</td>
</tr>
</tbody>
</table>

<p>
Dans d'autre configurations, le µC et les capteurs forment un sous système intégré dans un système plus large. 
Ce sous système n'effectue aucune action à part renvoyer ses données à un autre sous sytème.
Par exemple dans une automobile, en IOT ou en robotique.
</p>



<div class="figure">
<p><img src="./img/voiture.jpg" alt="voiture.jpg" width="500px" />
</p>
</div>


<div class="figure">
<p><img src="./img/turtlebot.png" alt="turtlebot.png" width="500px" />
</p>
</div>

<p>
En général le µC se trouve sur une carte électronique où l'on pourra trouver le minimum pour travailler comme des boutons, des LEDS et des connecteurs&#x2026;
La plus connues de ces cartes est la carte ARDUINO UNO, architecturée autour d'un µC ATmega328P.
</p>
</div>
</div>



<div id="outline-container-orge177457" class="outline-2">
<h2 id="orge177457">Carte d'évaluation Nucleo</h2>
<div class="outline-text-2" id="text-orge177457">
<p>
Il existe une grande variété de constructeur et de gammes. En général, le choix d'un micro controller se fait en fonction des taches qu'il aura à accomplir et des contraintes en terme
de coûts, de consommation, de l'ergonomie de l'interface de développement&#x2026;
</p>

<p>
Nous utiliserons une carte d'évaluation du constructeur ST Microelectronics.
Cette carte d'évaluation est issue de la gamme Nucleo.
</p>




<div class="figure">
<p><img src="./img/hw_block_diagram.jpg" alt="hw_block_diagram.jpg" width="500px" />
</p>
</div>


<div class="figure">
<p><img src="./img/top_layout.jpg" alt="top_layout.jpg" width="500px" />
</p>
</div>


<p>
Voici les documents relatifs à la carte d'évaluation Nucleo STM32L476RG
</p>

<p>
<a href="../stm/stm32_l476_usermanual.pdf">Manuel utilisateur</a>
</p>


<p>
<a href="../stm/stm32_l476_schematic.pdf">Schéma électrique</a>
</p>

<p>
<a href="../stm/stm32_l476_datasheet.pdf">Datasheet STM32L476RG</a>
</p>
</div>





<div id="outline-container-org04d1b26" class="outline-3">
<h3 id="org04d1b26">LED (Utilisateur)</h3>
<div class="outline-text-3" id="text-org04d1b26">
</div>
<div id="outline-container-org49f3862" class="outline-4">
<h4 id="org49f3862">Hardware</h4>
<div class="outline-text-4" id="text-org49f3862">

<div class="figure">
<p><img src="./img/led.jpg" alt="led.jpg" width="400px" /> 
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org580ce08" class="outline-3">
<h3 id="org580ce08">Bouton Poussoir (Utilisateur)</h3>
<div class="outline-text-3" id="text-org580ce08">
</div>
<div id="outline-container-orgd3fa37c" class="outline-4">
<h4 id="orgd3fa37c">Hardware</h4>
<div class="outline-text-4" id="text-orgd3fa37c">

<div class="figure">
<p><img src="./img/button.jpg" alt="button.jpg" width="400px" /> 
</p>
</div>
</div>
</div>
</div>
</div>




<div id="outline-container-org75d76c9" class="outline-2">
<h2 id="org75d76c9">Le microcontroller</h2>
<div class="outline-text-2" id="text-org75d76c9">
</div>
<div id="outline-container-org47d9aaf" class="outline-3">
<h3 id="org47d9aaf">Caractéristiques</h3>
<div class="outline-text-3" id="text-org47d9aaf">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Board</th>
<th scope="col" class="org-left">Nucleo STM32L476RG</th>
<th scope="col" class="org-left">Arduino Uno</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Family</td>
<td class="org-left">ARM Cortex-M4</td>
<td class="org-left">ATMega 328P</td>
</tr>

<tr>
<td class="org-left">Vendor</td>
<td class="org-left">ST Microelectronics</td>
<td class="org-left">ATMega</td>
</tr>

<tr>
<td class="org-left">Vcc</td>
<td class="org-left">1.71 V - 3.6V</td>
<td class="org-left">3.3 - 5V</td>
</tr>

<tr>
<td class="org-left">Bus size</td>
<td class="org-left">32 bits</td>
<td class="org-left">8 bits</td>
</tr>

<tr>
<td class="org-left">SRAM</td>
<td class="org-left">128 KB</td>
<td class="org-left">2 KB</td>
</tr>

<tr>
<td class="org-left">Flash</td>
<td class="org-left">1 MB</td>
<td class="org-left">32 KB</td>
</tr>

<tr>
<td class="org-left">Frequency</td>
<td class="org-left">up to 80MHz</td>
<td class="org-left">16</td>
</tr>

<tr>
<td class="org-left">FPU</td>
<td class="org-left">YES</td>
<td class="org-left">NO</td>
</tr>

<tr>
<td class="org-left">Timers</td>
<td class="org-left">16</td>
<td class="org-left">3</td>
</tr>

<tr>
<td class="org-left">ADCs</td>
<td class="org-left">1x 12-bit</td>
<td class="org-left">6 (10 bits)</td>
</tr>

<tr>
<td class="org-left">DAC</td>
<td class="org-left">1</td>
<td class="org-left">1</td>
</tr>

<tr>
<td class="org-left">UARTs</td>
<td class="org-left">3</td>
<td class="org-left">1</td>
</tr>

<tr>
<td class="org-left">SPIs</td>
<td class="org-left">3</td>
<td class="org-left">1</td>
</tr>

<tr>
<td class="org-left">I2Cs</td>
<td class="org-left">3</td>
<td class="org-left">1</td>
</tr>

<tr>
<td class="org-left">RTC</td>
<td class="org-left">1</td>
<td class="org-left">0</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-org5b31f0a" class="outline-3">
<h3 id="org5b31f0a">Architecture</h3>
<div class="outline-text-3" id="text-org5b31f0a">
<p>
Voir page 17 de la datasheet
</p>


<div class="figure">
<p><img src="./img/uc_diagram.jpg" alt="uc_diagram.jpg" />
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-orgb901e97" class="outline-2">
<h2 id="orgb901e97">CubeIDE: Configuration du projet</h2>
<div class="outline-text-2" id="text-orgb901e97">

<div class="figure">
<p><img src="./img/boardselection.jpg" alt="boardselection.jpg" width="800px" />
</p>
</div>


<div class="figure">
<p><img src="./img/projectgenerator.jpg" alt="projectgenerator.jpg" width="800px" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgc251c19" class="outline-2">
<h2 id="orgc251c19">CubeIDE: Configuration et utilisation des périphériques</h2>
<div class="outline-text-2" id="text-orgc251c19">
</div>
<div id="outline-container-org593242f" class="outline-3">
<h3 id="org593242f">NomDuProjet.ioc</h3>
<div class="outline-text-3" id="text-org593242f">
<p>
La première étape avant d'utiliser un périphérique est de le configurer. Ceci ce fait via une interface graphique.
Cette interface génère infine du code.
</p>
</div>
</div>


<div id="outline-container-orgf10191d" class="outline-3">
<h3 id="orgf10191d">HAL (Hardware Abstraction Layer)</h3>
<div class="outline-text-3" id="text-orgf10191d">
<p>
Nous utiliserons les fonctions HAL incluent dans l'environnement de développement.
Elles permettent de simplifier le travail du développeur concernant l'utilisation, la configuration et l'initialisation 
des périphériques du microcontroller.
</p>
</div>
</div>


<div id="outline-container-orgf8081eb" class="outline-3">
<h3 id="orgf8081eb">GPIO (General purpose Input Outpout.)</h3>
<div class="outline-text-3" id="text-orgf8081eb">
<p>
Ce sont les broches du micro controleur qui peuvent être utilisées comme entrée ou sortie selon leur configuration. On y branche typiquement une LED ou un bouton poussoir. Il y a 3 ports (A, B, C) comportant chacun 16 broches. Par exemple, PA8 est la 8e broche du port A. Il y a theoriquement 48 GPIO de disponible sur notre carte.
</p>


<p>
Drivers&gt;STM32L4xx<sub>HAL</sub><sub>Driver</sub>&gt;stm32l4xx<sub>hal</sub><sub>gpio.h</sub>
Ce fichier fournit par STMicro définit les masques derriere les alias GPIO<sub>PIN</sub><sub>X</sub> ainsi que toutes les fonctions relatives à l'utilisation des GPIO
</p>
</div>


<div id="outline-container-org961560b" class="outline-4">
<h4 id="org961560b">Configuration</h4>
<div class="outline-text-4" id="text-org961560b">
<p>
Afin de configuer les GPIO en entrée ou en sortie, ainsi que les assignés à certains périphériques (controler de bus, convertisseur, timer&#x2026;):
</p>
<ul class="org-ul">
<li>Clique gauche sur les broches pour les configurer en sorties ou en entrée</li>
<li>Clique droit sur une broche pour lui donner un label</li>
</ul>
</div>
</div>

<div id="outline-container-orgfeecf0b" class="outline-4">
<h4 id="orgfeecf0b">main.h</h4>
<div class="outline-text-4" id="text-orgfeecf0b">
<p>
Les directives suivantes permettent de faire le lien entre les user<sub>label</sub> et les noms des broches
</p>
<div class="org-src-container">
<pre class="src src-C++"><span style="font-weight: bold;">#define</span> <span style="font-weight: bold; font-style: italic;">user_label</span> nom_broche
<span style="font-weight: bold;">#define</span> <span style="font-weight: bold; font-style: italic;">B1_Pin</span> GPIO_PIN_13
<span style="font-weight: bold;">#define</span> <span style="font-weight: bold; font-style: italic;">LD2_Pin</span> GPIO_PIN_5
<span style="font-weight: bold;">#define</span> <span style="font-weight: bold; font-style: italic;">D8_Pin</span> GPIO_PIN_9
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca774ac" class="outline-4">
<h4 id="orgca774ac">main.c</h4>
<div class="outline-text-4" id="text-orgca774ac">
<p>
Cette fonction généré automatiquement configure les GPIO <br />
</p>
<div class="org-src-container">
<pre class="src src-C++"><span style="font-weight: bold;">static</span> <span style="font-weight: bold; text-decoration: underline;">void</span> <span style="font-weight: bold;">MX_GPIO_Init</span>(<span style="font-weight: bold; text-decoration: underline;">void</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1eb8a8c" class="outline-4">
<h4 id="org1eb8a8c">Ecriture</h4>
<div class="outline-text-4" id="text-org1eb8a8c">
<div class="org-src-container">
<pre class="src src-C++"><span style="font-weight: bold; text-decoration: underline;">void</span> <span style="font-weight: bold;">HAL_GPIO_WritePin</span>(<span style="font-weight: bold; text-decoration: underline;">GPIO_TypeDef</span>* <span style="font-weight: bold; font-style: italic;">GPIOx</span>, <span style="font-weight: bold; text-decoration: underline;">uint16_t</span> <span style="font-weight: bold; font-style: italic;">GPIO_Pin</span>, <span style="font-weight: bold; text-decoration: underline;">GPIO_PinState</span> <span style="font-weight: bold; font-style: italic;">PinState</span>);
</pre>
</div>

<p>
Exemple:
</p>
<div class="org-src-container">
<pre class="src src-C++">HAL_GPIO_WritePin(GPIOA, LD2_Pin, RESET);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-C++"><span style="font-weight: bold; text-decoration: underline;">void</span> <span style="font-weight: bold;">HAL_GPIO_TogglePin</span>(<span style="font-weight: bold; text-decoration: underline;">GPIO_TypeDef</span> *<span style="font-weight: bold; font-style: italic;">GPIOx</span>, <span style="font-weight: bold; text-decoration: underline;">uint16_t</span> <span style="font-weight: bold; font-style: italic;">GPIO_Pin</span>);
</pre>
</div>

<p>
Exemple:
</p>
<div class="org-src-container">
<pre class="src src-C++">HAL_GPIO_TogglePin(GPIOA, LD2_Pin);
</pre>
</div>
</div>
</div>

<div id="outline-container-orge940a30" class="outline-4">
<h4 id="orge940a30">Lecture</h4>
<div class="outline-text-4" id="text-orge940a30">
<div class="org-src-container">
<pre class="src src-C++"><span style="font-weight: bold; text-decoration: underline;">GPIO_PinState</span> <span style="font-weight: bold;">HAL_GPIO_ReadPin</span>(<span style="font-weight: bold; text-decoration: underline;">GPIO_TypeDef</span>* <span style="font-weight: bold; font-style: italic;">GPIOx</span>, <span style="font-weight: bold; text-decoration: underline;">uint16_t</span> <span style="font-weight: bold; font-style: italic;">GPIO_Pin</span>);
</pre>
</div>

<p>
Exemple: 
</p>
<div class="org-src-container">
<pre class="src src-C++">PinState = HAL_GPIO_ReadPin(GPIOC, B1_Pin);
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf014e6e" class="outline-3">
<h3 id="orgf014e6e">Délai</h3>
<div class="outline-text-3" id="text-orgf014e6e">
<div class="org-src-container">
<pre class="src src-C++"><span style="font-weight: bold; text-decoration: underline;">void</span> <span style="font-weight: bold;">HAL_Delay</span> (<span style="font-weight: bold; text-decoration: underline;">uint32_t</span> <span style="font-weight: bold; font-style: italic;">Delay</span>);
</pre>
</div>

<p>
L'argument entre parenthèse est un entier, qui est le temps en millisecondes.
Exemple:
</p>
<div class="org-src-container">
<pre class="src src-C++"><span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Temporistion de 10 ms</span>
HAL_Delay(10);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdfcccbf" class="outline-3">
<h3 id="orgdfcccbf">RS232</h3>
<div class="outline-text-3" id="text-orgdfcccbf">
</div>
<div id="outline-container-org2b0d1be" class="outline-4">
<h4 id="org2b0d1be">Configuration</h4>
<div class="outline-text-4" id="text-org2b0d1be">
<p>
Si vous avez suivi l'étape de configuration de votre projet pour la carte d'évaluation Nucleo L476RG, la configuration de la liason série est déjà faite.
C'est le rôle du Board Support Package (BSP) de faciliter la configuration logiciels des cartes du commerce.
Dans notre cas, il s'agit d'une liaison "serial over USB". Le protocol série est utiliser au travers d'une connection USB.
Vous pouvez éditer la configuration existante comme indiqué ci dessous (baudrate, checksum&#x2026;)
<img src="./img/serial_conf.jpg" alt="serial_conf.jpg" />
</p>

<p>
Le code C généré par cette interface doit se retrouver dans le fichier uart.c, dont voici un extrait:
</p>
<div class="org-src-container">
<pre class="src src-C++"><span style="font-weight: bold;">#include</span> <span style="font-style: italic;">"usart.h"</span>

<span style="font-weight: bold; text-decoration: underline;">UART_HandleTypeDef</span> <span style="font-weight: bold; font-style: italic;">huart2</span>;

<span style="font-weight: bold; text-decoration: underline;">void</span> <span style="font-weight: bold;">MX_USART2_UART_Init</span>(<span style="font-weight: bold; text-decoration: underline;">void</span>)
{
  huart2.Instance = USART2;
  huart2.Init.BaudRate = 9600;
  huart2.Init.WordLength = UART_WORDLENGTH_8B;
  huart2.Init.StopBits = UART_STOPBITS_1;
  huart2.Init.Parity = UART_PARITY_NONE;
  huart2.Init.Mode = UART_MODE_TX_RX;
  huart2.Init.HwFlowCtl = UART_HWCONTROL_NONE;
  huart2.Init.OverSampling = UART_OVERSAMPLING_16;
  huart2.Init.OneBitSampling = UART_ONE_BIT_SAMPLE_DISABLE;
  huart2.AdvancedInit.AdvFeatureInit = UART_ADVFEATURE_NO_INIT;
  <span style="font-weight: bold;">if</span> (HAL_UART_Init(&amp;huart2) != HAL_OK)
  {
    Error_Handler();
  }
  <span style="font-weight: bold; font-style: italic;">/* </span><span style="font-weight: bold; font-style: italic;">USER CODE BEGIN USART2_Init 2</span><span style="font-weight: bold; font-style: italic;"> */</span>

  <span style="font-weight: bold; font-style: italic;">/* </span><span style="font-weight: bold; font-style: italic;">USER CODE END USART2_Init 2</span><span style="font-weight: bold; font-style: italic;"> */</span>

}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c07dd5" class="outline-4">
<h4 id="org7c07dd5">Emission (µC vers PC)</h4>
<div class="outline-text-4" id="text-org7c07dd5">
<div class="org-src-container">
<pre class="src src-C++">HAL_UART_Transmit (<span style="font-weight: bold; text-decoration: underline;">UART_HandleTypeDef</span> *<span style="font-weight: bold; font-style: italic;">huart</span>, <span style="font-weight: bold; text-decoration: underline;">uint8_t</span> *<span style="font-weight: bold; font-style: italic;">pData</span>, <span style="font-weight: bold; text-decoration: underline;">uint16_t</span> <span style="font-weight: bold; font-style: italic;">Size</span>, <span style="font-weight: bold; text-decoration: underline;">uint32_t</span> <span style="font-weight: bold; font-style: italic;">Timeout</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-C++"><span style="font-weight: bold; text-decoration: underline;">char</span> <span style="font-weight: bold; font-style: italic;">uart_tx_buff</span>[50];
<span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">uart_tx_buf_len</span>;
uart_tx_buf_len = sprintf(uart_tx_buff, <span style="font-style: italic;">"Nucleo L476RG connected\n\r"</span>);
HAL_UART_Transmit(&amp;huart2, (<span style="font-weight: bold; text-decoration: underline;">uint8_t</span>*) uart_tx_buff, uart_tx_buf_len,
                        100);
</pre>
</div>
</div>
</div>

<div id="outline-container-org422f457" class="outline-4">
<h4 id="org422f457">Reception (PC vers µC)</h4>
<div class="outline-text-4" id="text-org422f457">
<div class="org-src-container">
<pre class="src src-C++"><span style="font-weight: bold; text-decoration: underline;">HAL_StatusTypeDef</span> <span style="font-weight: bold;">HAL_UART_Receive</span>(<span style="font-weight: bold; text-decoration: underline;">UART_HandleTypeDef</span> *<span style="font-weight: bold; font-style: italic;">huart</span>,
<span style="font-weight: bold; text-decoration: underline;">uint8_t</span> *       <span style="font-weight: bold; font-style: italic;">pData</span>,
<span style="font-weight: bold; text-decoration: underline;">uint16_t</span>        <span style="font-weight: bold; font-style: italic;">Size</span>,
<span style="font-weight: bold; text-decoration: underline;">uint32_t</span>        <span style="font-weight: bold; font-style: italic;">Timeout</span> 
)       
</pre>
</div>

<p>
Exemple:
</p>
<div class="org-src-container">
<pre class="src src-C++">HAL_UART_Receive(&amp;huart2, uart_rx_buffer, 1, 10) 
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org067870e" class="outline-3">
<h3 id="org067870e">Convertisseur analogique-numérique</h3>
<div class="outline-text-3" id="text-org067870e">
</div>
<div id="outline-container-orge3199ec" class="outline-4">
<h4 id="orge3199ec">Configuration</h4>
<div class="outline-text-4" id="text-orge3199ec">
<p>
Voici les principaux paramètres accessible via l'interface graphique (.ioc) de configuration:
</p>
<ul class="org-ul">
<li>GPIO associé</li>
<li>Résolution</li>
<li>Fréquence d'échantillonnage</li>
</ul>


<div class="figure">
<p><img src="./img/adc_conf.jpg" alt="adc_conf.jpg" />
</p>
</div>
</div>
</div>


<div id="outline-container-orgdcaf961" class="outline-4">
<h4 id="orgdcaf961">Utilisation</h4>
<div class="outline-text-4" id="text-orgdcaf961">
<p>
Exemple de fonction définie par l'utilisateur permettant de récupérer d'utiliser l'ADC:
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold;">load_adc</span>(<span style="font-weight: bold; text-decoration: underline;">ADC_HandleTypeDef</span> <span style="font-weight: bold; font-style: italic;">hadc</span>, <span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">polTime</span>) {

        HAL_ADC_Start(&amp;hadc);
        HAL_ADC_PollForConversion(&amp;hadc, polTime);
        <span style="font-weight: bold;">return</span> HAL_ADC_GetValue(&amp;hadc);
}
</pre>
</div>
</div>
</div>
</div>
</div>




<div id="outline-container-org2c2f3d5" class="outline-2">
<h2 id="org2c2f3d5">Exemple de projet avec CubeIDE</h2>
<div class="outline-text-2" id="text-org2c2f3d5">
<p>
<a href="https://github.com/InnovationLab-EFREIParis/Stage_1DOF_DroneBench/tree/main/05_CubeIDE">https://github.com/InnovationLab-EFREIParis/Stage_1DOF_DroneBench/tree/main/05_CubeIDE</a>
</p>
</div>
</div>

<div id="outline-container-org90b65db" class="outline-2">
<h2 id="org90b65db">Tutoriels CubeIde</h2>
<div class="outline-text-2" id="text-org90b65db">
</div>
<div id="outline-container-orgb0df850" class="outline-3">
<h3 id="orgb0df850">Prise en main</h3>
<div class="outline-text-3" id="text-orgb0df850">
<iframe width="560" height="315" src="https://www.youtube.com/embed/hyZS2p1tW-g" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
</div>
</div>

<div id="outline-container-orgf404a06" class="outline-3">
<h3 id="orgf404a06">Exemple d'interface avec un capteur I2C</h3>
<div class="outline-text-3" id="text-orgf404a06">
<iframe width="560" height="315" src="https://www.youtube.com/embed/isOekyygpR8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
</div>
</div>

<div id="outline-container-org7a94ae9" class="outline-3">
<h3 id="org7a94ae9">Compteur et interruption</h3>
<div class="outline-text-3" id="text-org7a94ae9">
<iframe width="560" height="315" src="https://www.youtube.com/embed/VfbW6nfG4kw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
</div>
</div>
</div>


<div id="outline-container-org407f99b" class="outline-2">
<h2 id="org407f99b">Exercices</h2>
<div class="outline-text-2" id="text-org407f99b">
<p>
Pour les exercices suivant, vous pouvez vous aider de la fonction delay.
</p>
</div>


<div id="outline-container-org4a1a133" class="outline-3">
<h3 id="org4a1a133">Exercice 1</h3>
<div class="outline-text-3" id="text-org4a1a133">
<p>
Programmer la carte de façon à ce que la LED s'allume pendant 500ms puis s'éteigne pendant 1000ms de façon cyclique
</p>
</div>
</div>

<div id="outline-container-org2b3cbd1" class="outline-3">
<h3 id="org2b3cbd1">Exercice 2</h3>
<div class="outline-text-3" id="text-org2b3cbd1">
<p>
Programmer la carte de façon à ce que la LED s'allume lorsque l'on appuie sur le bouton et s'eteigne lorsque le bouton est relaché.
</p>
</div>
</div>

<div id="outline-container-org51ad3f3" class="outline-3">
<h3 id="org51ad3f3">Exercice 3</h3>
<div class="outline-text-3" id="text-org51ad3f3">
<p>
Programmer la carte de façon à ce que la LED s'allume quand on appuie sur le bouton, reste allumé quand on le relache, puis s'éteint à la pression suivante.
</p>
</div>
</div>

<div id="outline-container-org40107c5" class="outline-3">
<h3 id="org40107c5">Exercice 4</h3>
<div class="outline-text-3" id="text-org40107c5">
<p>
Envoyer votre prénom via l'UART toute les secondes, vérifier avec votre PC (via un terminal série) 
</p>
</div>
</div>

<div id="outline-container-org788db2f" class="outline-3">
<h3 id="org788db2f">Exercice 5</h3>
<div class="outline-text-3" id="text-org788db2f">
<p>
Programmer la carte de façon à ce que l'intensité de la luminosité de la LED augmente puis diminue jusq'à complètement s'éteindre, et cela de façon cyclique (période d'une seconde)
</p>
</div>
</div>
</div>


<div id="outline-container-orgc923cc5" class="outline-2">
<h2 id="orgc923cc5">Annexes</h2>
<div class="outline-text-2" id="text-orgc923cc5">
</div>
<div id="outline-container-org1dad054" class="outline-3">
<h3 id="org1dad054">Nom de broches</h3>
<div class="outline-text-3" id="text-org1dad054">
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
